
# Лекция 1-5: Метод join() и его особенности

## Основные темы лекции:

### 1. Что такое `join()`?
`join()` — это метод класса `java.lang.Thread`, который используется для ожидания завершения другого потока. Когда один поток (например, `main`) вызывает метод `join()` на объекте другого потока (например, `workerThread`), вызывающий поток (`main`) приостанавливает свое выполнение до тех пор, пока `workerThread` не завершит свою работу.

### 2. Объявление и перегрузки
Метод `join()` имеет три версии:
- **`join()`**: Ожидает завершения потока бесконечно долго.
- **`join(long millis)`**: Ожидает завершения потока в течение указанного количества миллисекунд. Если за это время поток не завершился, вызывающий поток продолжит свою работу.
- **`join(long millis, int nanos)`**: Версия с дополнительной наносекундной точностью.

Как и многие блокирующие методы, `join()` бросает `InterruptedException`, поэтому его вызов необходимо оборачивать в `try-catch`.

### 3. Ключевые особенности `join()`
- **Блокирует вызывающий поток**: Основное назначение — заставить текущий поток ждать.
- **Не освобождает мониторы**: Если `join()` вызывается внутри `synchronized` блока, монитор (блокировка) не будет освобожден.
- **Может быть прерван**: Ожидающий поток может быть прерван вызовом `interrupt()`, что приведет к `InterruptedException`.
- **Внутренняя реализация**: Внутри `join()` используется `wait()`. Когда поток завершает свою работу, JVM автоматически вызывает `notifyAll()` на его объекте, пробуждая все потоки, которые ожидали его завершения через `join()`.
- **Нельзя вызвать на самом себе**: Вызов `thread.join()` изнутри самого `thread` приведет к взаимной блокировке (deadlock), так как поток будет вечно ждать собственного завершения.

### 4. Пример использования
В лекции демонстрируется, как главный поток ждет завершения дочернего потока.

```java
public class JoinExample {
    public static void main(String[] args) {
        System.out.println("Главный поток запущен.");

        Thread workerThread = new Thread(() -> {
            try {
                System.out.println("  Дочерний поток начал работу.");
                for (int i = 1; i <= 5; i++) {
                    System.out.println("    Дочерний поток: шаг " + i);
                    Thread.sleep(500); // Имитация работы
                }
                System.out.println("  Дочерний поток завершил работу.");
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        });

        workerThread.start();

        try {
            // Главный поток ждет, пока дочерний поток не завершится
            System.out.println("Главный поток ожидает завершения дочернего потока...");
            workerThread.join();
        } catch (InterruptedException e) {
            System.err.println("Главный поток был прерван.");
            Thread.currentThread().interrupt();
        }

        System.out.println("Главный поток возобновил работу и завершается.");
    }
}
```

Если закомментировать строку `workerThread.join()`, главный поток завершится почти мгновенно, не дожидаясь дочернего.

### 5. Когда использовать `join()`?
- Когда результат работы одного потока необходим для продолжения работы другого.
- Для обеспечения последовательного выполнения потоков (например, запустить поток Б только после завершения потока А).
- При тестировании, чтобы главный тестовый поток дождался завершения всех вспомогательных потоков перед проверкой результатов.

### 6. Сравнение `join()`, `sleep()` и `wait()`

| Характеристика      | `join()`                                  | `Thread.sleep()`                          | `wait()`                                  |
|---------------------|-------------------------------------------|-------------------------------------------|-------------------------------------------|
| **Назначение**      | Ожидание завершения **другого** потока    | Пауза в **текущем** потоке                | Ожидание условия от другого потока        |
| **Класс**           | `Thread`                                  | `Thread`                                  | `Object`                                  |
| **Освобождение монитора** | **Нет**                                   | **Нет**                                   | **Да**                                    |
| **Контекст вызова** | В любом месте                             | В любом месте                             | Только в `synchronized` блоке/методе      |
| **Пробуждение**     | По завершении другого потока или таймауту | По истечении времени или `interrupt()`     | По вызову `notify()`/`notifyAll()` или таймауту |

## Итог
`join()` — это простой и эффективный способ синхронизации, когда одному потоку нужно дождаться полного завершения другого. Он отличается от `sleep()` (который просто делает паузу) и `wait()` (который ждет сигнала об изменении условия и освобождает блокировку).
